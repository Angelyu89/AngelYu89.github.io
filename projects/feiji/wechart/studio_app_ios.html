<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta content="no-cache" http-equiv="Cache-Control">
    <link rel="stylesheet" href="css/base.css" type="text/css">
    <link rel="stylesheet" href="css/style.css" type="text/css">
    <link rel="stylesheet" href="css/page.css" type="text/css">
    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="css/bootstrap-datetimepicker.min.css" rel="stylesheet" media="screen">
    <title>叫个飞机</title>
</head>
<body>
	<div class="container">
      <!--   <div class="ssskkk"></div>  -->
        <div class="studio_head_wrap">
            <img class="studio_head_img" src="images/studio_head_bg.jpg" alt="头图背景">
            <img class="studio_head" src="" alt="工作室头像">
            <span class="studio_name"></span>
        </div>

        <div class="fixed_wrap">
            <div class="app_choose_wrap">
                <ul class="app_fill">
                    <li>
                        <i class="app_fill_icon icon7"></i>
                        <div class="father_type_div">请选择服务项目</div>
                    </li>
                </ul>
                <span class="none" id="order_type_sub">服务类型</span>
                <ul id="order_type_list" class="app_choose_ul">

                </ul>
            </div>
            <ul class="app_fill">
                <li>
                    <i class="app_fill_icon icon1"></i>
                    <div class="input-group date form_date col-md-5" data-date="" data-date-format="yyyy-mm-dd" data-link-field="dtp_input2" data-link-format="yyyy-mm-dd">
                        <input class="form-control" id="s_time" type="text" value=""  placeholder="请选择开始服务时间" readonly>
                        <span class="input-group-addon"><span class="glyphicon_date glyphicon-calendar"></span></span>
                    </div>
                </li>
                <li>
                    <i class="app_fill_icon icon1"></i>
                    <div class="input-group date form_date col-md-5" data-date="" data-date-format="yyyy-mm-dd" data-link-field="dtp_input2" data-link-format="yyyy-mm-dd">
                        <input class="form-control" id="e_time" type="text" value=""  placeholder="请选择结束服务时间" readonly>
                        <span class="input-group-addon"><span class="glyphicon_date glyphicon-calendar"></span></span>
                    </div>
                </li>
                <li>
                    <i class="app_fill_icon icon6"></i>
                    <div id="city_2">
                        <select class="prov"></select> 
                        <select class="city" disabled="disabled"></select>
                        <select class="dist" disabled="disabled"></select>
                    </div>
                </li>
                <li>
                    <i class="app_fill_icon icon2"></i>
                    <input type="text" id="address_service" placeholder="请输入详细服务地址">
                </li>
                <li>
                    <i class="app_fill_icon icon3"></i>
                    <input type="text" id="people_service" placeholder="联系人">
                </li>
                <li>
                    <i class="app_fill_icon icon4"></i>
                    <input type="text"  id="phone_service" placeholder="联系电话">
                </li>
                <li>
                    <i class="app_fill_icon icon5"></i>
                    <input type="text" id="txt_service" placeholder="请填写您的详细要求">
                </li>
            </ul>
        </div>
        <div class="order_footer">
            <a href="javascript:;" id="crruntsubmit" class="app_a">确定下单</a>
        </div>
    </div>
    <!--选择父类-->
    <div class="choose_wrap">
        <div class="bg_mask"></div>
        <div class="father_type">
            服务项目
            <ul id="father_type_ul">
                
            </ul>
            <a class="cancel" href="javascript:;">取消</a>
            <a class="confirm" href="javascript:;">确定</a>
        </div>
    </div>
    <!--end-->
    <!--预约失败提示-->
    <div class="fail_wrap">
        <div class="bg_mask"></div>
        <div class="fail_box">
            <img class="app_fail_img" src="images/app_fail.png" alt="失败图片">
            <span>服务器开小差了</span>
            <p>您可尝试再次预约或拨打客服电话进行预约</p>
            <a href="javascript:;">我知道了</a>
        </div> 
    </div>
    <!--end预约失败提示-->
    <!--错误提示-->
    <div class="error_wrap">
        <div class="bg_mask_fff"></div>
        <div class="error_box">
        </div>
        <span id="service_span">请输入电话</span>
    </div>
    <!--end错误提示-->

    <div class="loading_wrap">
        <div class="bg_mask"></div>
        <div class="loading_box">
            <img class="loading" src="images/loading.png" alt="loading">
            <span>请耐心等待，您叫的飞机正在飞来~</span>
        </div> 
    </div>
	<script language="javascript" type="text/javascript" src="js/jquery.js"></script>
    <script language="javascript" type="text/javascript" src="js/fun_all.js"></script>	
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/bootstrap-datetimepicker.js" charset="UTF-8"></script>
    <script type="text/javascript" src="js/bootstrap-datetimepicker.fr.js" charset="UTF-8"></script>
    <script src="js/bootstrap-datetimepicker.zh-CN.js" charset="UTF-8"></script>
    <script type="text/javascript" src="js/jquery.cityselect.js"></script>
    <script type="text/javascript">  
        $('.form_date').datetimepicker({
            language: 'zh-CN',
            weekStart: 1,
            todayBtn:  1,
            autoclose: 1,
            todayHighlight: 1,
            startView: 2,
            minView: 2,
            forceParse: 0
        });
        $('.form_date').datetimepicker('setStartDate', new Date());

        $("#s_time").change(function(){
            $('#e_time_div').datetimepicker('setStartDate', $("#s_time").val());
        })
        var typename_str = "";
        var father_type_val = "";
        $(document).ready(function () {
            var studioid = getUrlParam("studioid");
            sutdio_list(studioid);
            $(function(){ 
                $("#city_2").citySelect({
                    prov:"北京",
                    nodata:"none"
                });
            });
        });

        function sutdio_list(studioid) {
            //alert(param);
            $.ajax({
                url: "http://123.57.174.52:8080/app/Studio_studioDetailQuery",
                type: "POST",
                data: "jsonCallback=studioListCallback&devices=weixin&params= {\"studioid\":\"" + studioid + "\"}",

                dataType: "jsonp",
                callback: 'studioListCallback',

            });
        }
        function studioListCallback(v) {
            var status_val = v.status;
            if (status_val == 1) {
                //获取工作室详情对象
                var studioDetail = v.studioDetail;
                //获取服务类型数组ordertypes
                var ordertypes = studioDetail.ordertypes;
                var typename_str = "";
                for (var i = 0; i<ordertypes.length;i++)
                {
                    var typeid = ordertypes[i].typeid;
                    var typename = ordertypes[i].typename;
                    var typeimageurl = ordertypes[i].typeimageurl;
                    var ordertype_sub = ordertypes[i].ordertype_sub;
                    ordertype_sub   =     JSON.stringify(ordertype_sub);
                    typename_str = typename_str + "<li class=\"father_type_li\" typeid=\"" + typeid + "\"   id=\"" + typeid + "\"   >" + typename + "<span class=\"round\"></span></li>";
                }
                $("#father_type_ul").append(typename_str);

                for (var j = 0; j < ordertypes.length; j++)
                {
                    var typeid = ordertypes[j].typeid;
                    var ordertype_sub = ordertypes[j].ordertype_sub;
                    //ordertype_sub = JSON.stringify(ordertype_sub);
                    $("#" + typeid + "").bind("click", ordertype_sub, getData);
                }
            }
            else if (status_val == 0) {
                alert("empty");
            }
        }
        //工作室下单选择父级菜单
        $(".father_type_div").click(function(){
            $(".choose_wrap").show();
        })        

        function getData(v) {
            var data = v.data;
            $("#order_type_list").text("");
            $("#order_type_sub").css("display","block");
            for (var i = 0; i < data.length; i++)
            {
                var typeid = data[i].typeid;
                var typename = data[i].typename;
                //alert(typeid + "====" + typename);
                var typeid_name = "";
                typeid_name = typeid_name + "<li class=\"app_choose_li\"  onclick=\"app_choose_li(this);\">"+typename+"</li>";
                $("#order_type_list").append(typeid_name);
            }
            $(".round").empty();
            $(this).children(".round").append("<img id=\"select\" src=\"images/select.png\" alt=\"选中\">");
            $(".father_type_li").removeAttr("true");
            $(this).attr("true","true");
        }

        function getUrlParam(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
            var r = window.location.search.substr(1).match(reg);  //匹配目标参数
            if (r != null) return unescape(r[2]); return null; //返回参数值
        }

        $(".confirm").click(function(){
            $(".choose_wrap").hide();    
        })
        $(".cancel").click(function(){ 
            var typeid = $(".father_type_li[true]").attr("id");
            //存预约的父类id
            localStorage.setItem("ordertype",typeid);
            $(".choose_wrap").hide();    
        })
    </script>
    <script src="js/app_place.js" charset="UTF-8"></script>
</body>
</html>
